<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSH Meme Gallery - BT25CSH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; }
        .scroll-container { scroll-behavior: smooth; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyB7eRfEYcEVkudLbANLJXFR1q5z9weJuIs",
            authDomain: "csh-memes.firebaseapp.com",
            projectId: "csh-memes",
            storageBucket: "csh-memes.firebasestorage.app",
            messagingSenderId: "1044239899607",
            appId: "1:1044239899607:web:ba89f70716487e001e4992",
            measurementId: "G-RY1YE3HL4B"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Lucide Icons as inline SVG
        const icons = {
            Upload: (size = 24) => `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>`,
            LogOut: (size = 24) => `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>`,
            Star: (size = 24) => `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`,
            Image: (size = 24) => `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>`,
            Lock: (size = 24) => `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`,
            Heart: (size = 24) => `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>`,
            ChevronLeft: (size = 24) => `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>`,
            ChevronRight: (size = 24) => `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>`
        };

        // Compress image before uploading
        function compressImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        const maxDimension = 1200;
                        if (width > maxDimension || height > maxDimension) {
                            if (width > height) {
                                height = (height / width) * maxDimension;
                                width = maxDimension;
                            } else {
                                width = (width / height) * maxDimension;
                                height = maxDimension;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        class MemeGallery {
            constructor() {
                this.state = {
                    isLoggedIn: false,
                    isAdmin: false,
                    userEmail: '',
                    email: '',
                    password: '',
                    currentTab: 'memes',
                    hallOfFameMemes: [],
                    hallOfFameMemories: [],
                    memes: [],
                    memories: [],
                    showLogin: false,
                    loading: true,
                    error: '',
                    uploadStatus: '',
                    firebaseReady: false,
                    memeScrollIndex: 0,
                    memoryScrollIndex: 0
                };
                this.memeScrollInterval = null;
                this.memoryScrollInterval = null;
                this.init();
            }

            async init() {
                await this.authenticateAnonymously();
                await this.loadAllData();
                this.render();
                this.setupRealtimeListeners();
                this.startAutoScroll();
            }

            async authenticateAnonymously() {
                try {
                    await signInAnonymously(auth);
                    this.state.firebaseReady = true;
                } catch (error) {
                    console.error('Firebase auth error:', error);
                }
            }

            setupRealtimeListeners() {
                onSnapshot(query(collection(db, 'hall-of-fame-memes'), orderBy('timestamp', 'desc')), (snapshot) => {
                    this.state.hallOfFameMemes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.state.loading = false;
                    this.render();
                });

                onSnapshot(query(collection(db, 'hall-of-fame-memories'), orderBy('timestamp', 'desc')), (snapshot) => {
                    this.state.hallOfFameMemories = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.render();
                });

                onSnapshot(query(collection(db, 'memes'), orderBy('timestamp', 'desc')), (snapshot) => {
                    this.state.memes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.render();
                });

                onSnapshot(query(collection(db, 'memories'), orderBy('timestamp', 'desc')), (snapshot) => {
                    this.state.memories = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.render();
                });
            }

            async loadAllData() {
                try {
                    const [hofMemes, hofMemories, memes, memories] = await Promise.all([
                        getDocs(query(collection(db, 'hall-of-fame-memes'), orderBy('timestamp', 'desc'))),
                        getDocs(query(collection(db, 'hall-of-fame-memories'), orderBy('timestamp', 'desc'))),
                        getDocs(query(collection(db, 'memes'), orderBy('timestamp', 'desc'))),
                        getDocs(query(collection(db, 'memories'), orderBy('timestamp', 'desc')))
                    ]);
                    
                    this.state.hallOfFameMemes = hofMemes.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.state.hallOfFameMemories = hofMemories.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.state.memes = memes.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.state.memories = memories.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (err) {
                    console.log('Error loading data:', err);
                }
                this.state.loading = false;
            }

            startAutoScroll() {
                this.memeScrollInterval = setInterval(() => {
                    if (this.state.hallOfFameMemes.length > 1) {
                        this.scrollMemes('next');
                    }
                }, 5000);

                this.memoryScrollInterval = setInterval(() => {
                    if (this.state.hallOfFameMemories.length > 1) {
                        this.scrollMemories('next');
                    }
                }, 5000);
            }

            scrollMemes(direction) {
                const maxIndex = Math.max(0, this.state.hallOfFameMemes.length - 1);
                if (direction === 'next') {
                    this.state.memeScrollIndex = (this.state.memeScrollIndex + 1) % this.state.hallOfFameMemes.length;
                } else {
                    this.state.memeScrollIndex = this.state.memeScrollIndex === 0 ? maxIndex : this.state.memeScrollIndex - 1;
                }
                const container = document.getElementById('meme-scroll-container');
                if (container) {
                    const width = container.offsetWidth;
                    container.scrollTo({ left: width * this.state.memeScrollIndex, behavior: 'smooth' });
                }
            }

            scrollMemories(direction) {
                const maxIndex = Math.max(0, this.state.hallOfFameMemories.length - 1);
                if (direction === 'next') {
                    this.state.memoryScrollIndex = (this.state.memoryScrollIndex + 1) % this.state.hallOfFameMemories.length;
                } else {
                    this.state.memoryScrollIndex = this.state.memoryScrollIndex === 0 ? maxIndex : this.state.memoryScrollIndex - 1;
                }
                const container = document.getElementById('memory-scroll-container');
                if (container) {
                    const width = container.offsetWidth;
                    container.scrollTo({ left: width * this.state.memoryScrollIndex, behavior: 'smooth' });
                }
            }

            handleLogin(e) {
                e.preventDefault();
                this.state.error = '';

                const emailLower = this.state.email.toLowerCase().trim();
                const emailRegex = /^bt25csh\d{3}@iiitn\.ac\.in$/i;

                if (emailLower === 'bt25csh050@iiitn.ac.in' && this.state.password === 'wushangclanssSS11!!') {
                    this.state.isLoggedIn = true;
                    this.state.isAdmin = true;
                    this.state.userEmail = emailLower;
                    this.state.showLogin = false;
                } else if (emailRegex.test(emailLower) && this.state.password === 'cshthegoat') {
                    this.state.isLoggedIn = true;
                    this.state.isAdmin = false;
                    this.state.userEmail = emailLower;
                    this.state.showLogin = false;
                } else {
                    this.state.error = 'Invalid credentials. Check your email format and password.';
                }
                this.render();
            }

            handleLogout() {
                this.state.isLoggedIn = false;
                this.state.isAdmin = false;
                this.state.userEmail = '';
                this.state.email = '';
                this.state.password = '';
                this.render();
            }

            async handleFileUpload(file, type) {
                if (!file) return;

                if (!file.type.startsWith('image/')) {
                    this.state.uploadStatus = 'Please upload an image file';
                    this.render();
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    this.state.uploadStatus = 'Image must be less than 5MB';
                    this.render();
                    return;
                }

                this.state.uploadStatus = 'Compressing and uploading...';
                this.render();

                try {
                    const compressedImage = await compressImage(file);
                    const sizeInBytes = (compressedImage.length * 3) / 4;
                    if (sizeInBytes > 1000000) {
                        this.state.uploadStatus = 'Image too large after compression. Try a smaller image.';
                        this.render();
                        return;
                    }

                    const timestamp = Date.now();
                    const collectionName = type === 'memory' ? 'memories' : 'memes';

                    await addDoc(collection(db, collectionName), {
                        imageData: compressedImage,
                        uploadedBy: this.state.userEmail,
                        timestamp: timestamp,
                        fileName: file.name
                    });

                    this.state.uploadStatus = `${type === 'memory' ? 'Memory' : 'Meme'} uploaded successfully! ðŸŽ‰`;
                    setTimeout(() => {
                        this.state.uploadStatus = '';
                        this.render();
                    }, 3000);
                } catch (err) {
                    this.state.uploadStatus = 'Upload failed. Please try again.';
                    console.error('Upload error:', err);
                }
                this.render();
            }

            async promoteToHallOfFame(item, type) {
                try {
                    const hofCollection = type === 'memory' ? 'hall-of-fame-memories' : 'hall-of-fame-memes';
                    const sourceCollection = type === 'memory' ? 'memories' : 'memes';

                    await addDoc(collection(db, hofCollection), {
                        imageData: item.imageData,
                        uploadedBy: item.uploadedBy,
                        timestamp: item.timestamp,
                        fileName: item.fileName
                    });

                    await deleteDoc(doc(db, sourceCollection, item.id));
                } catch (err) {
                    console.error('Failed to promote:', err);
                }
            }

            async removeFromHallOfFame(itemId, type) {
                try {
                    const hofCollection = type === 'memory' ? 'hall-of-fame-memories' : 'hall-of-fame-memes';
                    await deleteDoc(doc(db, hofCollection, itemId));
                } catch (err) {
                    console.error('Failed to remove:', err);
                }
            }

            render() {
                const root = document.getElementById('root');
                
                if (this.state.showLogin && !this.state.isLoggedIn) {
                    root.innerHTML = this.renderLoginModal();
                } else {
                    root.innerHTML = this.renderMainPage();
                }

                this.attachEventListeners();
            }

            renderLoginModal() {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-purple-600 via-pink-500 to-red-500 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md relative">
                            <button id="closeLogin" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                            
                            <div class="text-center mb-8">
                                <h1 class="text-4xl font-bold text-gray-800 mb-2">Login to Upload</h1>
                                <p class="text-gray-600">BT25CSH Members Only</p>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input id="emailInput" type="email" value="${this.state.email}" placeholder="bt25cshXXX@iiitn.ac.in" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                    <input id="passwordInput" type="password" value="${this.state.password}" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>

                                ${this.state.error ? `<div class="bg-red-50 text-red-600 p-3 rounded-lg text-sm">${this.state.error}</div>` : ''}

                                <button id="loginBtn" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition">
                                    Sign In
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderScrollingHallOfFame(items, type) {
                if (items.length === 0) {
                    return `
                        <div class="text-center py-12 bg-gradient-to-br ${type === 'memory' ? 'from-pink-50 to-purple-50 border-pink-200' : 'from-yellow-50 to-orange-50 border-yellow-200'} rounded-xl border-2">
                            ${type === 'memory' ? icons.Heart(64) : icons.Star(64)}
                            <p class="text-gray-600 text-lg mt-4">No Hall of Fame ${type === 'memory' ? 'memories' : 'memes'} yet!</p>
                            ${this.state.isAdmin ? '<p class="text-sm text-gray-500 mt-2">Promote from the gallery below</p>' : ''}
                        </div>
                    `;
                }

                const containerId = type === 'memory' ? 'memory-scroll-container' : 'meme-scroll-container';
                const borderColor = type === 'memory' ? 'border-pink-400' : 'border-yellow-400';
                const bgGradient = type === 'memory' ? 'from-pink-100 to-purple-100' : 'from-yellow-100 to-orange-100';

                return `
                    <div class="relative">
                        <div id="${containerId}" class="scroll-container overflow-hidden relative">
                            <div class="flex transition-transform duration-500">
                                ${items.map(item => `
                                    <div class="min-w-full px-2">
                                        <div class="bg-gradient-to-br ${bgGradient} rounded-xl overflow-hidden shadow-lg border-4 ${borderColor} relative max-w-3xl mx-auto">
                                            <img src="${item.imageData}" alt="Hall of Fame" class="w-full h-96 object-contain bg-white">
                                            <div class="p-6">
                                                <p class="text-base text-gray-700">By: <span class="font-semibold">${item.uploadedBy}</span></p>
                                                <p class="text-sm text-gray-600">${new Date(item.timestamp).toLocaleDateString()}</p>
                                            </div>
                                            ${this.state.isAdmin ? `
                                                <button data-remove-hof="${item.id}" data-type="${type}" class="absolute top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-600 shadow-lg">
                                                    Remove
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ${items.length > 1 ? `
                            <button data-scroll="${type}" data-direction="prev" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full p-3 shadow-lg z-10">
                                ${icons.ChevronLeft(32)}
                            </button>
                            <button data-scroll="${type}" data-direction="next" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full p-3 shadow-lg z-10">
                                ${icons.ChevronRight(32)}
                            </button>
                        ` : ''}
                    </div>
                `;
            }

            renderMainPage() {
                const currentData = this.state.currentTab === 'memes' 
                    ? { hall: this.state.hallOfFameMemes, regular: this.state.memes, type: 'meme' }
                    : { hall: this.state.hallOfFameMemories, regular: this.state.memories, type: 'memory' };

                return `
                    <div class="min-h-screen bg-gray-50">
                        <nav class="bg-white shadow-md sticky top-0 z-20">
                            <div class="max-w-7xl mx-auto px-4 py-4">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h1 class="text-2xl font-bold text-gray-800">CSH Gallery</h1>
                                        <p class="text-sm text-gray-600">BT25CSH Batch</p>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        ${!this.state.isLoggedIn ? `
                                            <button id="showLoginBtn" class="flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition text-sm">
                                                ${icons.Lock(16)}
                                                Login to Upload
                                            </button>
                                        ` : `
                                            <div class="flex items-center gap-3">
                                                ${this.state.isAdmin ? '<span class="bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full text-xs font-bold">ADMIN</span>' : ''}
                                                <span class="text-sm text-gray-600">${this.state.userEmail}</span>
                                                <button id="logoutBtn" class="flex items-center gap-2 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition text-sm">
                                                    ${icons.LogOut(16)}
                                                    Logout
                                                </button>
                                            </div>
                                        `}
                                    </div>
                                </div>
                                
                                <div class="flex gap-2 border-b border-gray-200">
                                    <button data-tab="memes" class="${this.state.currentTab === 'memes' ? 'border-b-2 border-purple-600 text-purple-600' : 'text-gray-600 hover:text-purple-600'} px-6 py-3 font-semibold transition">
                                        Memes
                                    </button>
                                    <button data-tab="memories" class="${this.state.currentTab === 'memories' ? 'border-b-2 border-pink-600 text-pink-600' : 'text-gray-600 hover:text-pink-600'} px-6 py-3 font-semibold transition">
                                        Memories
                                    </button>
                                </div>
                            </div>
                        </nav>

                        <div class="max-w-7xl mx-auto px-4 py-8">
                            ${this.state.isLoggedIn && !this.state.isAdmin ? `
                                <div class="mb-8 bg-white rounded-2xl p-6 shadow-md">
                                    <h2 class="text-xl font-bold text-gray-800 mb-4">Upload Your ${this.state.currentTab === 'memes' ? 'Meme' : 'Memory'}</h2>
                                    <label class="flex items-center justify-center gap-3 bg-gradient-to-r ${this.state.currentTab === 'memes' ? 'from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700' : 'from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700'} text-white px-6 py-3 rounded-xl cursor-pointer transition font-semibold">
                                        ${icons.Upload(20)}
                                        Choose ${this.state.currentTab === 'memes' ? 'Meme' : 'Memory'} to Upload
                                        <input id="fileInput" type="file" accept="image/*" class="hidden">
                                    </label>
                                    ${this.state.uploadStatus ? `<p class="mt-4 text-center text-green-600 font-medium">${this.state.uploadStatus}</p>` : ''}
                                </div>
                            ` : ''}

                            <div class="mb-12">
                                <div class="flex items-center gap-3 mb-6">
                                    ${this.state.currentTab === 'memes' ? icons.Star(32) : icons.Heart(32)}
                                    <h2 class="text-3xl font-bold text-gray-800">Hall of Fame</h2>
                                </div>
                                ${this.state.loading ? `
                                    <div class="text-center py-12"><p class="text-gray-600">Loading...</p></div>
                                ` : this.renderScrollingHallOfFame(currentData.hall, currentData.type)}
                            </div>

                            ${this.state.isLoggedIn ? `
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-800 mb-6">All ${this.state.currentTab === 'memes' ? 'Memes' : 'Memories'}</h2>
                                    ${currentData.regular.length === 0 ? `
                                        <div class="text-center py-12 bg-white rounded-xl">
                                            ${icons.Image(64)}
                                            <p class="text-gray-600 text-lg mt-4">No ${this.state.currentTab} yet. Be the first to upload!</p>
                                        </div>
                                    ` : `
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            ${currentData.regular.map(item => `
                                                <div class="bg-white rounded-xl overflow-hidden shadow-md hover:shadow-xl transition relative">
                                                    <img src="${item.imageData}" alt="${currentData.type}" class="w-full h-64 object-contain bg-gray-100">
                                                    <div class="p-4">
                                                        <p class="text-sm text-gray-700">By: <span class="font-semibold">${item.uploadedBy}</span></p>
                                                        <p class="text-xs text-gray-600">${new Date(item.timestamp).toLocaleDateString()}</p>
                                                    </div>
                                                    ${this.state.isAdmin ? `
                                                        <button data-promote="${item.id}" data-type="${currentData.type}" class="absolute top-2 right-2 ${this.state.currentTab === 'memes' ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-pink-500 hover:bg-pink-600'} text-white px-3 py-1 rounded-lg text-xs flex items-center gap-1">
                                                            ${this.state.currentTab === 'memes' ? icons.Star(12) : icons.Heart(12)}
                                                            Hall of Fame
                                                        </button>
                                                    ` : ''}
                                                </div>
                                            `).join('')}
                                        </div>
                                    `}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            attachEventListeners() {
                const closeLogin = document.getElementById('closeLogin');
                if (closeLogin) closeLogin.onclick = () => { this.state.showLogin = false; this.render(); };

                const showLoginBtn = document.getElementById('showLoginBtn');
                if (showLoginBtn) showLoginBtn.onclick = () => { this.state.showLogin = true; this.render(); };

                const loginBtn = document.getElementById('loginBtn');
                if (loginBtn) loginBtn.onclick = (e) => this.handleLogin(e);

                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) logoutBtn.onclick = () => this.handleLogout();

                const emailInput = document.getElementById('emailInput');
                if (emailInput) emailInput.oninput = (e) => { this.state.email = e.target.value; };

                const passwordInput = document.getElementById('passwordInput');
                if (passwordInput) passwordInput.oninput = (e) => { this.state.password = e.target.value; };

                const fileInput = document.getElementById('fileInput');
                if (fileInput) fileInput.onchange = (e) => this.handleFileUpload(e.target.files[0], this.state.currentTab === 'memories' ? 'memory' : 'meme');

                document.querySelectorAll('[data-tab]').forEach(btn => {
                    btn.onclick = () => {
                        this.state.currentTab = btn.getAttribute('data-tab');
                        this.render();
                    };
                });

                document.querySelectorAll('[data-scroll]').forEach(btn => {
                    btn.onclick = () => {
                        const type = btn.getAttribute('data-scroll');
                        const direction = btn.getAttribute('data-direction');
                        if (type === 'meme') {
                            this.scrollMemes(direction);
                        } else {
                            this.scrollMemories(direction);
                        }
                    };
                });

                document.querySelectorAll('[data-promote]').forEach(btn => {
                    btn.onclick = () => {
                        const itemId = btn.getAttribute('data-promote');
                        const type = btn.getAttribute('data-type');
                        const items = type === 'memory' ? this.state.memories : this.state.memes;
                        const item = items.find(m => m.id === itemId);
                        if (item) this.promoteToHallOfFame(item, type);
                    };
                });

                document.querySelectorAll('[data-remove-hof]').forEach(btn => {
                    btn.onclick = () => {
                        const itemId = btn.getAttribute('data-remove-hof');
                        const type = btn.getAttribute('data-type');
                        this.removeFromHallOfFame(itemId, type);
                    };
                });
            }
        }

        new MemeGallery();
    </script>
</body>
</html>
